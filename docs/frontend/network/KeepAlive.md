---
title: 长连接
description: 了解实现长连接的几种方式
category: network
tags:
  - network
  - KeepAlive
---

# 客户端与服务端长连接

## HTTP长连接

- 可以重用一个 `TCP` 连接，减少了每次请求时建立 `TCP` 连接的开销。

- 适用于轻量级的数据交换，比如 `Web` 资源的传输。

- 由于使用 `HTTP` 协议，因此兼容性较好，可用于浏览器和服务器之间的通信。

**缺点：**

- 无法实现服务器端主动推送数据，需要客户端轮询或者使用 `Comet` 等技术来模拟长连接。

- 长时间保持连接会占用服务器的资源，如果同时有大量客户端连接，则会造成服务器压力过大。

- `HTTP` 协议的头部信息比较冗余，增加了数据传输的开销。

## WebSocket长连接

- 建立在 `HTTP` 协议之上，与 `HTTP` 协议兼容，因此能够穿透大多数防火墙和代理服务器。

- 可以实现服务器端主动推送数据，可以用于实时通信、在线游戏等场景。

- 采用二进制传输，传输效率高。

- `WebSocket` 协议采用了基于帧的传输方式，消息的边界明确，便于解析。

**缺点：**

- 对服务器端的性能要求较高，需要保持大量的连接和维护状态，服务器压力较大。

- 长时间保持连接会占用服务器的资源，如果同时有大量客户端连接，则会造成服务器压力过大。

- 需要客户端和服务器端都支持 `WebSocket` 协议。

`Socket` 建立网络连接的步骤如下：

1. 创建 `Socket` 对象：客户端和服务端都需要创建 `Socket` 对象。客户端创建 `Socket` 对象时，需要指定服务端的 `IP`
   地址和端口号；服务端创建 `Socket` 对象时，只需要指定端口号。

2. 连接服务端：客户端需要调用 `Socket` 对象的 `connect()` 方法连接服务端。服务端不需要调用该方法，因为服务端是被动的，等待客户端连接即可。

3. 获取输入输出流：连接成功后，客户端和服务端都需要获取对应的输入输出流，用于数据的读写。

4. 进行数据的读写：通过输入输出流进行数据的读写，客户端和服务端都可以发送和接收数据。

5. 关闭连接：使用完毕后，需要关闭 `Socket` 连接，释放资源。

:::warning
在使用 `Socket` 进行网络编程时，可能会抛出各种异常，如 `SocketException`、`IOException` 等，需要进行异常处理。
:::

## TCP长连接

- 直接建立在 `TCP` 层，没有 `HTTP` 协议头的开销，传输效率高。

- 可以实现服务器端主动推送数据。

- 对于较大量级的数据交换，`TCP` 长连接的效率比 `HTTP` 长连接要高。

**缺点：**

- 需要客户端和服务器端都支持 `TCP` 协议。

- `TCP` 长连接需要维护连接状态，因此对服务器的性能要求较高。

- 如果同时有大量客户端连接，则会造成服务器压力过大。

:::tip
- 对于简单的 `Web` 应用，使用 `HTTP` 长连接即可满足需求；

- 对于实时通信或在线游戏等场景，可以选择 `WebSocket` 长连接；

- 而对于大量数据交换的场景，`TCP` 长连接可能更为适合。
:::
